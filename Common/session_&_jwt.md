# Session과 JWT

비 연결적인 특성을 가지는 HTTP 요청은 연결이 해제됨과 동시에 서버와 클라이언트는 이전 요청에 대해 잊어버리게 된다. 이러한 특성으로 HTTP는 `Stateless(무상태성) Protocal`이라고 불리기도 하며 웹사이트는 매 페이지에서 로그인이 되어있는지 확인하는 인증 방식이 필요하다.

로그인 시스템에서 Authentication(인증)과 Authorization(인가 또는 권한 부여)는 중요한 개념이다. 웹사이트에서 **로그인 하는것을 Authentication**이라고 한다. 한번 로그인을 한 뒤에는 **로그인 상태가 유지되어야 하고 이를 Authorization이 담당**한다. 요청을 할 때마다 로그인을 할 수는 없으니 로그인 상태를 유지하는 기술이 필요하다. 이 때 사용되는 기술이 Session과 JWT이다.

## 세션(Session)

세션은 사용자가 웹서버에 접속해 있는 상태를 하나의 단위로 두고 그것을 Session 이라고 한다. 다시말해, 세션은 브라우저와 웹 서버가 연결된 후 브라우저가 종료될 때까지의 시점이다. 

서버는 하나의 세션에 세션 id를 부여한 뒤, 이를 같은 브라우저인지 식별할 때 사용한다. 브라우저를 통해 서버에 접속할 때 서버는 세션 id를 쿠키에 담아 돌려주고, 사용자는 세션 id를 담은 쿠키인 세션 쿠키를 이후 요청부터 계속해서 함께 전달한다. 이를 가지고 서버가 클라이언트를 식별할 수 있게 하는 기술이 세션 기반 인증 방식인데 보통은 세션이라고 칭한다.

만약 클라이언트의 HTTP 요청에 쿠키에 세션 id가 없다면 서버는 세션 id를 생성해 쿠키에 담아서 돌려준다. 이 쿠키로 다시 HTTP 요청을 보내면 서버가 클라이언트를 다시 식별할 수 있게 되고 로그인이 유지되는 것이다.

### 쿠키와 세션

쿠키와 세션의 가장 큰 차이는 저장 위치이다. 쿠키는 클라이언트에, 세션은 서버에 저장된다. 그러나 서로 반대 되는 개념은 아니고 세션 기반 인증 방식에서 세션 id를 쿠키에 담아서 통신한다는 점에서 세션은 쿠키를 사용하는 방식이라고 할 수 있다.

## JWT
토큰 방식의 가장 대표적인 방법인 JWT는 JSON Web Token의 약자로 이상한 형태의 문자열을 말한다.<br/>
세션과 유사하게 사용자를 인증할 수 있는 토큰을 클라이언트에게 보내준다.

쉽게 설명하자면, JWT는 일종의 확인서이다. 우리가 어떤 웹사이트에 로그인을 해서 성공적으로 Authentication(인증)이 이루어지면 서버는 JWT를 우리에게 제공한다. 앞으로 우리는 요청 때마다 이 확인서를 함께 보여주면서 권한을 확인 받는 것이다.

### 토큰의 저장 위치

토큰을 웹에 저장하기 위해서 웹 스토리지 또는 쿠키를 사용할 수 있다. 세션 스토리지, 로컬 스토리지에 JWT를 저장하는 경우 스크립트 공격에 취약해질 수 있다. 쿠키에 저장할 때 `http-only` 옵션을 사용하여 저장하면 비교적 보안을 강화 할 수 있다.

[브라우저 저장소의 차이점](https://github.com/Study-Mole/study-cs-mole/blob/main/Common/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80_%EC%A0%80%EC%9E%A5%EC%86%8C%EC%9D%98_%EC%B0%A8%EC%9D%B4%EC%A0%90.md)은 링크를 통해 확인해부자.

## 세션 vs JWT
세션은 세션 id로 로그인 된 유저의 정보를 저장하고 있기 때문에 비교적 쉽게 유저를 통제할 수 있다. <br/>
예를들어, 동시 접속을 막고 싶을 때 강제 로그아웃을 시키는 기능은 세션 인증 방식을 통해 구현이 가능하다.

이와 달리 JWT 방식에서 서버는 JWT를 만든 이후 따로 저장하여 관리하지 않는다. <br/>
JWT를 클라이언트 쪽에서 보내 왔을 때 토큰이 유효한지만 검사하기 때문에 서버 자원을 절감할 수 있다. 

그러나 JWT의 수명이 너무 길어 제 3자에게 탈취 당하는 경우가 발생할 수도 있다. 이를 보완하기 위해서 access token과 refresh token을 함께 사용한다.

### access token과 refresh token
이 방식은 access token과 refresh token에 각각 다른 유효 기간을 두는 방식이다.<br/> access token은 유효 기간이 짧고, refresh token은 유효 기간이 보다 긴 토큰이다. 동작 방식은 아래와 같다.
1. 유저가 로그인을 하면 서버는 access token과 refresh token을 생성하여 클라이언트에 전달하고 refresh token을 안전한 곳에 저장한다.
2. access token이 아직 유효하다면, 요청에 access token을 함께 보낸다. 서버는 이를 보고 유효한 요청임을 확인한다.
3. access token의 유효 기간이 지났다면, 유저는 refresh token을 요청에 실어 보낸다. 서버는 저장해두었던 refresh token과 비교한 뒤 유효하다면 새 access token을 응답과 함께 보낸다.

<br/>

[참고]
- [세션(Session)과 JWT](https://velog.io/@gotaek/%EC%84%B8%EC%85%98Session%EA%B3%BC-JWT)