# 중요 요청 체이닝 방지

웹 성능을 높이는 핵심 전략 중 하나로, **중요 요청 체인을 줄이는 방법**이 있다. 중요한 요청들이 연결되어 있으면 각 요청이 순차적으로 지연될 수 있으므로, 이를 최적화하면 **페이지 로드 지표(FCP, LCP 등)**가 크게 개선된다. 아래에서 중요 요청 체인이 무엇인지, 왜 문제가 되는지, 그리고 이를 어떻게 개선할 수 있는지 살펴보자.

## 1. 중요한 요청(critical request)이란?

- **페이지 렌더링에 필수적인 리소스**를 의미한다.
  - 보통 CSS, 자바스크립트 파일 등이 이에 해당된다.
- 브라우저는 이러한 리소스들이 모두 로드될 때까지 **화면에 콘텐츠를 표시하지 않고 대기**하기 때문에, 해당 리소스가 지연되면 전체 렌더링이 늦어질 수 있다.

## 2. “중요 요청 체이닝”이 안 좋은 이유

- 중요한 요청들이 “체인 형태”로 이어지면, 앞선 요청이 완료되어야만 뒤의 요청을 시작하거나 처리할 수 있다.
- **각 요청의 지연이 누적**되어 결국 **FCP(First Contentful Paint), LCP(Largest Contentful Paint)** 등 핵심 로딩 지표가 나빠진다.
- 사용자 체감 성능과 SEO에도 부정적인 영향을 미칠 수 있다.

## 3. 라이트하우스로 체인 분석하기

- **구글 라이트하우스(Lighthouse)**에서 **“중요한 요청 체인 피하기(Avoid chaining critical requests)”**라는 감사를 통해 체인을 이루는 리소스들을 확인할 수 있다.
- 이 분석 결과로 **병목 지점**(체인이 길어지는 부분)을 찾아 리소스 로드 순서를 최적화하면 된다.

### 하나의 체인만 있는 이상적인 경우

- 거의 모든 리소스가 초기 HTML에 직접 연결되어, 별도 체인 없이 로드된다.
- 지연이 최소화되어 로딩 성능이 크게 향상된다.

## 4. 중요 요청 체인을 줄이는 대표 전략

1. **글꼴(font) 프리로드(preload)**

   - `<link rel="preload" ...>`를 통해 폰트를 미리 불러오면, 해당 폰트가 **렌더링 차단** 요청으로 분류되지 않는다.

2. **자바스크립트 지연(defer/async)**

   - `<script src="..." defer>` 또는 `<script src="..." async>` 속성을 사용해 로드하면, HTML 렌더링을 막지 않고 백그라운드에서 JS를 다운로드한다.
   - **렌더링 블로킹**이 사라지므로, 해당 JS는 “중요 요청”에서 제외된다.

3. **LCP 이미지를 HTML 문서에서 직접 요청**

   - 페이지의 핵심 이미지(LCP 요소)는 가능한 한 빨리 로드되도록 **초기 HTML**에서 바로 불러오면 좋다.
   - 다만 사용자 체감 성능을 위해 가장 중요한 이미지에 대해서는 **가장 우선순위**를 두는 전략이 필요하다.

4. **CSS·JS 압축(minify), HTTP/2 멀티플렉싱, 지연 로딩(lazy-loading), 프리페치(prefetch)/프리커넥트(preconnect)** 등의 추가 기법
   - CSS·JS 파일 크기를 줄이고, HTTP/2로 병렬 전송을 늘리며, 이미지·동영상 등 비필수 리소스를 **사용 시점**에만 로드하는 방식으로 체인을 짧게 유지한다.
   - 외부 도메인 리소스에는 **preconnect**나 **prefetch**를 적용해 DNS 및 초기 연결 시간을 단축할 수 있다.

## 5. 실제 사례

### 예시 1: 자바스크립트 요청 지연

- 여러 개의 JS 스크립트가 **렌더링 차단**을 일으켜 FCP, LCP가 늦어졌다.
- `defer`를 사용하여 자바스크립트를 지연 로드한 후, 대부분 “중요 요청”에서 제외되었다.
- **FCP와 LCP가 각각 약 750ms, 1초 정도** 빨라져 사용자 체감 성능이 크게 개선되었다.

### 예시 2: CSS import 체인

- CSS 파일 `build/style.css` 로드 후에야 또 다른 폰트(구글 폰트)가 import되는 구조로 인해 **체인이 길어졌다**.
- **프리로드** 등을 통해 import 요청을 렌더링 차단에서 제외시키자, **FCP가 500ms 이상** 개선되었다.

## 6. 결론

중요 요청 체인을 줄이는 것은 **웹 성능 개선**에서 매우 중요한 영역이다. 자바스크립트 지연 로드, CSS 프리로드, 핵심(LCP) 이미지를 빠르게 로딩하는 등의 최적화를 통해 **페이지 로드 시간을 크게 단축**할 수 있다.

Lighthouse, DebugBear 등의 도구를 활용해 **지속적으로 성능 측정** 및 개선 과정을 모니터링하면, 더 체계적으로 최적화 결과를 확인할 수 있다.
위 전략들을 적절히 적용하여 **필요한 리소스만 빠르게 로드**하고, 불필요한 체인을 끊어낸다면, **FCP/LCP 같은 핵심 로딩 지표**를 확실히 개선할 수 있다.
